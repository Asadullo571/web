<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Telefon Qopqoqlari Do'koni</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f2f5; color:#333; }
    header { background:#0088cc; color:white; padding:15px; text-align:center; position:sticky; top:0; z-index:10; }
    .products { display:grid; grid-template-columns:repeat(auto-fill, minmax(160px, 1fr)); gap:15px; padding:15px; }
    .product { background:white; border-radius:12px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.1); text-align:center; }
    .product img { width:100%; height:140px; object-fit:cover; }
    .info { padding:10px; }
    .price { font-weight:bold; color:#e74c3c; margin:5px 0; }
    .add-btn { background:#27ae60; color:white; border:none; padding:10px; width:100%; cursor:pointer; font-size:16px; }
    .add-btn:hover { background:#219653; }
    .qty-controls { display:flex; align-items:center; justify-content:center; margin:8px 0; }
    .qty-btn { background:#ddd; border:none; width:30px; height:30px; font-size:18px; cursor:pointer; border-radius:4px; margin:0 5px; }
    .qty-btn:hover { background:#ccc; }
    .qty-display { font-size:18px; min-width:30px; text-align:center; }
    #cart { position:fixed; bottom:0; left:0; right:0; background:white; padding:15px; box-shadow:0 -4px 12px rgba(0,0,0,0.2); transform:translateY(100%); transition:transform 0.4s ease; z-index:100; }
    #cart.open { transform:translateY(0); }
    #cart-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    #cart-items { max-height:220px; overflow-y:auto; margin-bottom:10px; }
    .cart-item { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid #eee; }
    .cart-qty { display:flex; align-items:center; }
    #toggle-cart { position:fixed; bottom:20px; right:20px; background:#0088cc; color:white; border:none; border-radius:50%; width:60px; height:60px; font-size:18px; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.3); z-index:110; }
  </style>
</head>
<body>

  <header><h2>üõí Botlar narxlari</h2></header>

  <div class="products" id="products"></div>

  <div id="cart">
    <div id="cart-header">
      <h3>Savat</h3>
      <button onclick="toggleCart()" style="background:#e74c3c; padding:8px 12px; border-radius:8px; color:white;">Yopish</button>
    </div>
    <div id="cart-items"></div>
    <div style="text-align:right; font-weight:bold; margin:10px 0;">Jami: <span id="total">0 so'm</span></div>
    <button onclick="checkout()" style="width:100%; padding:12px; background:#27ae60; color:white; border:none; border-radius:8px; font-size:18px;">Buyurtma berish</button>
  </div>

  <button id="toggle-cart" onclick="toggleCart()">üõçÔ∏è</button>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // Mahsulotlar (sizning rasmlaringizni Imgur linklari bilan almashtiring)
    const products = [
      { 
        id: 1, 
        name: "Maker bot Oddiy", 
        price: 75000, 
        img: src="e.png"   // oddiy qora minimalist
      },
      { 
        id: 2, 
        name: "Maker bot Norm", 
        price: 130000, 
        img: "e.png"  // oddiy qora minimalist
      },
      { 
        id: 3, 
        name: "Maker bot super", 
        price: 700000, 
        img: "e.png"  // oddiy qora minimalist
      },
      { 
        id: 4, 
        name: "Stars bot", 
        price: 50000, 
        img: "q.png"  // oddiy qora minimalist
      },
      { 
        id: 5, 
        name: "Kino bot", 
        price: 50000, 
        img: "s.png"  // oddiy qora minimalist
      },
      { 
        id: 6, 
        name: "Nomer bot", 
        price: 70000, 
        img: "w.png"  // oddiy qora minimalist
      },
    ];

    let cart = []; // {id, name, price, quantity}

    const container = document.getElementById('products');

    function renderProducts() {
      container.innerHTML = '';
      products.forEach(p => {
        const itemInCart = cart.find(c => c.id === p.id);
        const qty = itemInCart ? itemInCart.quantity : 0;

        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
          <img src="${p.img}" alt="${p.name}">
          <div class="info">
            <h3>${p.name}</h3>
            <p class="price">${p.price.toLocaleString()} so'm</p>
          </div>
          ${qty === 0 ? 
            `<button class="add-btn" onclick="addToCart(${p.id})">Savatga qo'shish</button>` :
            `<div class="qty-controls">
              <button class="qty-btn" onclick="changeQty(${p.id}, -1)">-</button>
              <span class="qty-display">${qty}</span>
              <button class="qty-btn" onclick="changeQty(${p.id}, 1)">+</button>
            </div>`
          }
        `;
        container.appendChild(div);
      });
    }

    function addToCart(id) {
      const product = products.find(p => p.id === id);
      const existing = cart.find(c => c.id === id);
      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      updateCart();
      renderProducts();
      tg.showPopup({ title: "Qo'shildi!", message: `${product.name} savatga qo'shildi ‚úÖ` });
    }

    function changeQty(id, delta) {
      const item = cart.find(c => c.id === id);
      if (item) {
        item.quantity = Math.max(1, item.quantity + delta);
        if (item.quantity === 0) {
          cart = cart.filter(c => c.id !== id);
        }
        updateCart();
        renderProducts();
      }
    }

    function updateCart() {
      const itemsDiv = document.getElementById('cart-items');
      itemsDiv.innerHTML = '';
      cart.forEach(item => {
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <span>${item.name} ‚Äî ${item.price.toLocaleString()} so'm</span>
          <div class="cart-qty">
            <button class="qty-btn" onclick="changeQty(${item.id}, -1)">-</button>
            <span style="margin:0 8px;">${item.quantity}</span>
            <button class="qty-btn" onclick="changeQty(${item.id}, 1)">+</button>
          </div>
        `;
        itemsDiv.appendChild(div);
      });

      const totalSum = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      document.getElementById('total').textContent = totalSum.toLocaleString() + " so'm";

      tg.MainButton.setText(`Savat (${cart.reduce((s, i) => s + i.quantity, 0)}) - ${totalSum.toLocaleString()} so'm`);
      tg.MainButton.show();
    }

    function toggleCart() {
      document.getElementById('cart').classList.toggle('open');
    }

    function checkout() {
      if (cart.length === 0) return tg.showPopup({title:"Savat bo'sh", message:"Hech narsa yo'q"});
      const message = cart.map(i => `‚Ä¢ ${i.name} x${i.quantity} ‚Äî ${(i.price * i.quantity).toLocaleString()} so'm`).join('\n');
      tg.sendData(JSON.stringify({ action: "order", cart }));
      tg.showAlert("Buyurtma qabul qilindi! Tez orada aloqaga chiqamiz.");
      cart = [];
      updateCart();
      renderProducts();
      toggleCart();
    }

    tg.MainButton.onClick(toggleCart);

    // Dastlabki chizish
    renderProducts();
  </script>

</body>
</html>
